<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[function Blog() {};]]></title>
  <link href="http://lunchub.github.io/atom.xml" rel="self"/>
  <link href="http://lunchub.github.io/"/>
  <updated>2013-07-09T20:03:54+09:00</updated>
  <id>http://lunchub.github.io/</id>
  <author>
    <name><![CDATA[Daisuke Masuyama]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[OctopressでHTML, CSS, JSを圧縮する方法]]></title>
    <link href="http://lunchub.github.io/blog/2013/07/09/how-to-compress-html-and-assets-on-octopress/"/>
    <updated>2013-07-09T17:23:00+09:00</updated>
    <id>http://lunchub.github.io/blog/2013/07/09/how-to-compress-html-and-assets-on-octopress</id>
    <content type="html"><![CDATA[<h2>Environment</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Mac OSX 10.7.5 (Lion)
</span><span class='line'>ruby 1.9.3p392 (2013-02-22 revision 39386) [x86_64-darwin11.4.2]
</span><span class='line'>[Gems]
</span><span class='line'>  jekyll (0.12.0)
</span><span class='line'>  jekyll-press (0.2.1)
</span><span class='line'>  cssminify (1.0.2)</span></code></pre></td></tr></table></div></figure>


<h2>Issues</h2>

<h2>Solution</h2>

<p><a href="http://lunchub.github.io/images/posts/2013/06/2013-06-26-16-38-43.jpg"><img src="http://lunchub.github.io/images/posts/2013/06/2013-06-26-16-38-43.jpg" alt="" /></a></p>

<h2>References</h2>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Rails + Unicornの環境でNew Relicにデータが送信されない]]></title>
    <link href="http://lunchub.github.io/blog/2013/06/26/hamari-on-installing-new-relic-to-rails-with-unicorn/"/>
    <updated>2013-06-26T18:38:00+09:00</updated>
    <id>http://lunchub.github.io/blog/2013/06/26/hamari-on-installing-new-relic-to-rails-with-unicorn</id>
    <content type="html"><![CDATA[<h2>Environment</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>お名前VPS
</span><span class='line'>CentOS 6.4
</span><span class='line'>ruby 1.9.3p392 (2013-02-22 revision 39386) [x86_64-darwin11.4.2]
</span><span class='line'>Rails 3.2.13
</span><span class='line'>Unicorn v4.5.0</span></code></pre></td></tr></table></div></figure>


<h2>Issues</h2>

<p>前回までの記事で、</p>

<ul>
<li><a href="http://lunchub.github.io/blog/2013/06/26/installing-new-relic-to-rails/">RailsにNew Relicをインストールする</a></li>
<li><a href="http://lunchub.github.io/blog/2013/06/26/installing-new-relic-to-centos/">CeontOSにNew Relicをインストールする</a></li>
</ul>


<p>と、簡単に<code>New Relic</code>のインストールを行なってきたものの、問題が発生した。</p>

<p><code>Rails + Unicorn</code>の環境で、何時まで経っても<code>New Relic</code>にRailsのデータが送信されていないというもの。</p>

<h2>Solution</h2>

<p>これは<code>Unicorn</code>を使っている場合に発生する問題で、以下の手段で解決できます。<br/>
今回は後者の手段で解決しました。</p>

<p>なぜ<code>Unicorn</code>の<code>preload_app</code>が必要なのかは理解出来ませんでした・・</p>

<h2>How to</h2>

<h3>Unicornの設定に追記する</h3>

<p><code>RAILS_APP_ROOT/config</code>ディレクトリにある<code>Unicorn</code>の設定ファイルに以下のディレクティブを追記する。</p>

<figure class='code'><figcaption><span>unicorn.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>preload_app true
</span></code></pre></td></tr></table></div></figure>


<h3>Railsのinitializerを追加する</h3>

<p><code>RAILS_APP_ROOT/config/initializers/</code>ディレクトリに以下のファイルを追加する</p>

<figure class='code'><figcaption><span>new_relic.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># Ensure the agent is started using Unicorn.</span>
</span><span class='line'><span class="c1"># This is needed when using Unicorn and preload_app is not set to true.</span>
</span><span class='line'><span class="c1"># See https://newrelic.com/docs/ruby/no-data-with-unicorn</span>
</span><span class='line'><span class="k">if</span> <span class="n">defined?</span> <span class="no">Unicorn</span>
</span><span class='line'>  <span class="o">::</span><span class="ss">NewRelic</span><span class="p">:</span><span class="ss">:Agent</span><span class="o">.</span><span class="n">manual_start</span><span class="p">()</span>
</span><span class='line'>  <span class="o">::</span><span class="ss">NewRelic</span><span class="p">:</span><span class="ss">:Agent</span><span class="o">.</span><span class="n">after_fork</span><span class="p">(</span><span class="ss">:force_reconnect</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">)</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>ファイル名は何でもOKです。</p>

<h2>References</h2>

<ul>
<li><a href="https://newrelic.com/docs/ruby/no-data-with-unicorn">No Data with Unicorn</a></li>
<li><a href="http://unicorn.bogomips.org/Unicorn/Configurator.html#method-i-preload_app">Unicorn::Configurator</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[CentOSにNew Relicをインストールする]]></title>
    <link href="http://lunchub.github.io/blog/2013/06/26/installing-new-relic-to-centos/"/>
    <updated>2013-06-26T17:12:00+09:00</updated>
    <id>http://lunchub.github.io/blog/2013/06/26/installing-new-relic-to-centos</id>
    <content type="html"><![CDATA[<h2>Environment</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>お名前VPS
</span><span class='line'>CentOS 6.4</span></code></pre></td></tr></table></div></figure>


<h2>Issues</h2>

<ul>
<li>Railsのパフォーマンスを簡単に計測したい &ndash;> <a href="http://lunchub.github.io/blog/2013/06/26/installing-new-relic-to-rails/">Railsへの導入記事はこちら</a></li>
<li>ついでにサーバーのモニタリングもしたい</li>
<li>Muninとか自分で導入するのがめんどくさい</li>
</ul>


<h2>Solution</h2>

<p><a href="http://lunchub.github.io/blog/2013/06/26/installing-new-relic-to-rails/">前回の記事</a>に続いて、
<code>New Relic</code>をCentOSにインストールします。</p>

<p>インストール後は自動的にデータを収集してくれるので、<br/>
こちらも非常に手軽に導入できます。</p>

<h2>How to</h2>

<p>基本的に管理画面に記載されている内容そのままで導入できます。<br/>
<code>New Relic</code>にログイン後、サイドバーから<code>Servers</code>を選択し、さらに<code>RedHat or CentOS</code>を選択すると、<br/>
以下の画像のような表示になります。</p>

<p><a href="http://lunchub.github.io/images/posts/2013/06/2013-06-26-17-22-30.jpg"><img src="http://lunchub.github.io/images/posts/2013/06/2013-06-26-17-22-30.jpg" alt="newrelic admin panel image 2" /></a>
<a href="http://lunchub.github.io/images/posts/2013/06/2013-06-26-17-28-04.jpg"><img src="http://lunchub.github.io/images/posts/2013/06/2013-06-26-17-28-04.jpg" alt="newrelic admin panel image 3" /></a></p>

<p>後はこの画面の通りにコマンドを実行するだけなのですが、<br/>
気をつける点として、以下を挙げておきます。</p>

<ul>
<li>インストールは<code>root</code>ユーザで行う</li>
<li><code>yum install</code>には<code>sudo</code>をつける</li>
</ul>


<p>特に2番目でハマりました。環境依存の問題もあると思いますが、<br/>
<code>yum install</code>で<code>newrelic</code>ユーザが作成されなかったために、<br/>
<code>newrelic-sysmond start</code>が実行できませんでした。</p>

<p><code>yum install</code>で表示されていたエラー。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">[</span>root@tmp<span class="o">]</span><span class="c"># yum install newrelic-sysmond</span>
</span><span class='line'>Loaded plugins: fastestmirror
</span><span class='line'>Loading mirror speeds from cached hostfile
</span><span class='line'>epel/metalink                                                                                                                                                                                                          | 5.8 kB     00:00
</span><span class='line'> * base: www.ftp.ne.jp
</span><span class='line'> * epel: ftp.iij.ad.jp
</span><span class='line'> * extras: www.ftp.ne.jp
</span><span class='line'> * updates: www.ftp.ne.jp
</span><span class='line'>base                                                                                                                                                                                                                   | 3.7 kB     00:00
</span><span class='line'>epel                                                                                                                                                                                                                   | 4.2 kB     00:00
</span><span class='line'>extras                                                                                                                                                                                                                 | 3.4 kB     00:00
</span><span class='line'>newrelic                                                                                                                                                                                                               |  951 B     00:00
</span><span class='line'>newrelic/primary                                                                                                                                                                                                       | 2.1 kB     00:00
</span><span class='line'>newrelic                                                                                                                                                                                                                                  5/5
</span><span class='line'>updates                                                                                                                                                                                                                | 3.4 kB     00:00
</span><span class='line'>updates/primary_db                                                                                                                                                                                                     | 3.1 MB     00:00
</span><span class='line'>Setting up Install Process
</span><span class='line'>Resolving Dependencies
</span><span class='line'>--&gt; Running transaction check
</span><span class='line'>---&gt; Package newrelic-sysmond.x86_64 0:1.2.0.257-1 will be installed
</span><span class='line'>--&gt; Finished Dependency Resolution
</span><span class='line'>
</span><span class='line'>Dependencies <span class="nv">Resolved</span>
</span><span class='line'>
</span><span class='line'><span class="o">==============================================================================================================================================================================================================================================</span>
</span><span class='line'> Package                                                        Arch                                                 Version                                                     Repository                                              <span class="nv">Size</span>
</span><span class='line'><span class="o">==============================================================================================================================================================================================================================================</span>
</span><span class='line'>Installing:
</span><span class='line'> newrelic-sysmond                                               x86_64                                               1.2.0.257-1                                                 newrelic                                               1.2 M
</span><span class='line'>
</span><span class='line'>Transaction <span class="nv">Summary</span>
</span><span class='line'><span class="o">==============================================================================================================================================================================================================================================</span>
</span><span class='line'>Install       1 Package<span class="o">(</span>s<span class="o">)</span>
</span><span class='line'>
</span><span class='line'>Total download size: 1.2 M
</span><span class='line'>Installed size: 3.5 M
</span><span class='line'>Is this ok <span class="o">[</span>y/N<span class="o">]</span>: y
</span><span class='line'>Downloading Packages:
</span><span class='line'>newrelic-sysmond-1.2.0.257-1.x86_64.rpm                                                                                                                                                                                | 1.2 MB     00:03
</span><span class='line'>warning: rpmts_HdrFromFdno: Header V3 DSA/SHA1 Signature, key ID 548c16bf: NOKEY
</span><span class='line'>Retrieving key from file:///etc/pki/rpm-gpg/RPM-GPG-KEY-NewRelic
</span><span class='line'>Importing GPG key 0x548C16BF:
</span><span class='line'> Userid : New Relic &lt;support@newrelic.com&gt;
</span><span class='line'> Package: newrelic-repo-5-3.noarch <span class="o">(</span>installed<span class="o">)</span>
</span><span class='line'> From   : /etc/pki/rpm-gpg/RPM-GPG-KEY-NewRelic
</span><span class='line'>Is this ok <span class="o">[</span>y/N<span class="o">]</span>: y
</span><span class='line'>Running rpm_check_debug
</span><span class='line'>Running Transaction Test
</span><span class='line'>Transaction Test Succeeded
</span><span class='line'>Running Transaction
</span><span class='line'>Warning: RPMDB altered outside of yum.
</span><span class='line'>  Installing : newrelic-sysmond-1.2.0.257-1.x86_64                                                                                                                                                                                        1/1
</span><span class='line'>groupadd: cannot lock /etc/group; try again later.
</span><span class='line'>useradd: group <span class="s1">&#39;newrelic&#39;</span> does not exist
</span><span class='line'>warning: group newrelic does not exist - using root
</span><span class='line'>warning: user newrelic does not exist - using root
</span><span class='line'>warning: group newrelic does not exist - using root
</span><span class='line'>chown: invalid user: <span class="sb">`</span>newrelic:newrelic<span class="err">&#39;</span>
</span><span class='line'>su: user newrelic does not exist
</span><span class='line'>  Verifying  : newrelic-sysmond-1.2.0.257-1.x86_64                                                                                                                                                                                        1/1
</span><span class='line'>
</span><span class='line'>Installed:
</span><span class='line'>  newrelic-sysmond.x86_64 0:1.2.0.257-1
</span><span class='line'>
</span><span class='line'>Complete!
</span></code></pre></td></tr></table></div></figure>


<p>全然<code>Complete!</code>してねーよ！<code>groupadd</code>失敗してるやんけ・・</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[RailsにNew Relicをインストールする]]></title>
    <link href="http://lunchub.github.io/blog/2013/06/26/installing-new-relic-to-rails/"/>
    <updated>2013-06-26T16:01:00+09:00</updated>
    <id>http://lunchub.github.io/blog/2013/06/26/installing-new-relic-to-rails</id>
    <content type="html"><![CDATA[<h2>Environment</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ruby 1.9.3p392 (2013-02-22 revision 39386) [x86_64-darwin11.4.2]
</span><span class='line'>Rails 3.2.13</span></code></pre></td></tr></table></div></figure>


<h2>Issues</h2>

<ul>
<li>Railsのパフォーマンスを簡単に計測したい</li>
<li>ついでにサーバーのモニタリングもしたい &ndash;> <a href="http://lunchub.github.io/blog/2013/06/26/installing-new-relic-to-centos/">CentOSへの導入記事はこちら</a></li>
<li>Muninとか自分で導入するのがめんどくさい</li>
</ul>


<h2>Solution</h2>

<p><a href="https://newrelic.com/">New Relic</a>というサービスを利用する。<br/>
<code>New Relic</code>は簡単に導入が出来て、無料で使えるモニタリングサービス。<br/>
*但し無料版はログの保存期間が24時間しかない。</p>

<p>別途プラグインの導入を行うことで、サーバーのモニタリングも簡単にできます。</p>

<h2>How to</h2>

<h3><code>New Relic</code>のアカウントを取得する</h3>

<p><code>New Relic</code>のサイトで<a href="https://newrelic.com/">会員登録</a>を行う。</p>

<h3>Gemをインストールする</h3>

<figure class='code'><figcaption><span>Gemfile</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">gem</span> <span class="s1">&#39;newrelic_rpm&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>設定ファイルで<code>Environment</code>に応じたモニタリングのON/OFFができるので、<br/>
ここでは<code>production</code>グループに纏めたりしなくても良いと思います。</p>

<h3>configディレクトリに<code>newrelic.yml</code>を配置する</h3>

<p><code>newrelic.yml</code>は<code>New Relic</code>にログイン後、サイドバーから<code>Applications</code>を選択し、さらに<code>Add more</code>を選択するとダウンロード出来る画面へ遷移する。</p>

<p><a href="http://lunchub.github.io/images/posts/2013/06/2013-06-26-16-38-43.jpg"><img src="http://lunchub.github.io/images/posts/2013/06/2013-06-26-16-38-43.jpg" alt="newrelic admin panel image" /></a></p>

<p>画面遷移した後に、<code>Installation instructions for</code>で<code>Ruby</code>を選択すると、<br/>
下の画像のようにダウンロードボタンが出現する。</p>

<p><a href="http://lunchub.github.io/images/posts/2013/06/2013-06-26-16-50-31.jpg"><img src="http://lunchub.github.io/images/posts/2013/06/2013-06-26-16-50-31.jpg" alt="newrelic admin panel image" /></a></p>

<p>ダウンロードしてきた<code>newrelic.yml</code>を<code>RAILS_APP_ROOT/config</code>に配置すればOK!</p>

<h2>Tips</h2>

<p><code>newrelic.yml</code>の以下の部分を書き換えることで、<br/>
管理画面に表示されるアプリ名を変更できます。</p>

<figure class='code'><figcaption><span>newrelic.yml</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="l-Scalar-Plain">app_name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">My Application</span>
</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[uninitialized constant Readline (NameError)]]></title>
    <link href="http://lunchub.github.io/blog/2013/06/20/uninitialized-constant-readline-nameerror/"/>
    <updated>2013-06-20T15:56:00+09:00</updated>
    <id>http://lunchub.github.io/blog/2013/06/20/uninitialized-constant-readline-nameerror</id>
    <content type="html"><![CDATA[<h2>Environment</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Mac OSX 10.7.5 (Lion)
</span><span class='line'>ruby 1.9.3p392 (2013-02-22 revision 39386) [x86_64-darwin11.4.2]
</span><span class='line'>Rails 3.2.13
</span><span class='line'>[Gems]
</span><span class='line'>rb-readline (0.5.0)
</span><span class='line'>
</span><span class='line'>debugger (1.3.1)
</span><span class='line'>  columnize (&gt;= 0.3.1)
</span><span class='line'>  debugger-linecache (~&gt; 1.1.1)
</span><span class='line'>  debugger-ruby_core_source (~&gt; 1.1.8)
</span><span class='line'>debugger-linecache (1.1.2)
</span><span class='line'>  debugger-ruby_core_source (&gt;= 1.1.1)
</span><span class='line'>debugger-ruby_core_source (1.1.9)</span></code></pre></td></tr></table></div></figure>


<h2>Issues</h2>

<p><code>rails c</code>しようとすると、</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>uninitialized constant Debugger::LocalInterface::Readline <span class="o">(</span>NameError<span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>と表示されてコンソールに入れなくなっていた。</p>

<p>エラー内容から、<code>debugger</code>の問題を疑い、<code>Gemfile</code>から外してみる。<br/>
すると今度は<code>pry</code>が<code>Debugger</code>の部分だけ<code>Pry</code>に変わった同じエラーが出力される。<br/>
そこで<code>pry</code>を<code>Gemfile</code>から外し・・・ｒｙ</p>

<p>これを繰り返しても同じエラーが続く・・・<br/>
どうやら共通して<code>readline</code>辺りに問題があるらしい。</p>

<p>システムに<code>readline</code>がインストールされていないのかと思ったが、<br/>
<code>homebrew</code>でちゃんとインストールしてある・・</p>

<p><code>Gemfile</code>を眺めていると、<code>rb-readline</code>なるものが追加されている。<br/>
どうやらこいつが怪しい・・・</p>

<h2>Solution</h2>

<p>で、解決策は2つ</p>

<ul>
<li><code>rb-readline</code>のバージョン指定を<code>'~&gt; 0.4.2'</code>にする</li>
<li><code>rb-readline</code>を削除する（）</li>
</ul>


<p>問題は<code>rb-readline</code>が<code>0.5.0</code>からシステム上の<code>readline</code>を<code>remove_const</code>しちゃうこと。<br/>
どうもこのgemはC言語で実装された<code>readline</code>とは別に、<br/>
Rubyだけで完結させようって主旨なのかな？<br/>
それで既に<code>readline</code>があると再定義の警告が出るんで、<br/>
一度<code>remove_const</code>しちゃうぜってことらしい。<br/>
しかし他のgemのエラーからして、明らかにシステム上に<code>readline</code>があることを期待している気がする・・。<br/>
これってどうなんだろう・・。<br/>
一応<code>Readline</code>を呼んでいる部分を全て<code>RbReadline</code>に置換すれば動くっぽいけど・・ｗ</p>

<h3><code>rb-readline</code>のバージョン指定を<code>'~&gt; 0.4.2'</code>にする</h3>

<p>前述の<code>remove_const</code>が入るのはバージョン<code>0.5.0</code>から。<br/>
なので、この変更が入る前の<code>0.4.2</code>にしてあげればエラーはなくなる。</p>

<h3><code>rb-readline</code>を削除する（）</h3>

<p>こちらはシステム上に<code>readline</code>がインストールされていて、<br/>
かつRubyのビルドオプションで<code>--with-readline</code>をつけてビルドしている場合に有効。
システム上の<code>readline</code>を使ってくれるので<code>rb-readline</code>は不要になります。</p>

<p>ちなみにMacなら</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>brew install readline
</span><span class='line'><span class="nv">CONFIGURE_OPTS</span><span class="o">=</span><span class="s2">&quot;--disable-install-doc --with-readline-dir=$(brew --prefix readline)&quot;</span> rbenv install <span class="nv">$VERSION</span>
</span></code></pre></td></tr></table></div></figure>


<p>でビルドしなおせばOK!<br/>
<code>$VERSION</code>はお好みで。</p>

<h2>References</h2>

<ul>
<li><a href="https://github.com/luislavena/rb-readline/commit/d8b49a061eeb710c47bc92cc610e8f489c4fd447">[GitHub] Unload Readline before loading rb-readline</a></li>
<li><a href="http://stackoverflow.com/questions/16288331/rails-3-uninitialized-constant-irbreadlineinputmethodreadline-nameerror-i">[stackoverflow] Rails 3: uninitialized constant IRB::ReadlineInputMethod::Readline (NameError) in Heroku</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[[Rails] Active_adminのインストールと初期設定でハマったこと]]></title>
    <link href="http://lunchub.github.io/blog/2013/06/17/hamari-install-activeadmin-gem-to-rails/"/>
    <updated>2013-06-17T12:43:00+09:00</updated>
    <id>http://lunchub.github.io/blog/2013/06/17/hamari-install-activeadmin-gem-to-rails</id>
    <content type="html"><![CDATA[<h2>Environment</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Mac OSX 10.7.5 (Lion)
</span><span class='line'>ruby 1.9.3p392 (2013-02-22 revision 39386) [x86_64-darwin11.4.2]
</span><span class='line'>Rails 3.2.13
</span><span class='line'>[gems]
</span><span class='line'>jquery-rails (3.0.1)
</span><span class='line'>jquery-ui-rails (4.0.3)
</span><span class='line'>activeadmin (0.6.0)</span></code></pre></td></tr></table></div></figure>


<h2>Issues</h2>

<p>手っ取り早く管理画面を設置したくて<code>activeadmin</code>をインストールしたところ、<br/>
初っ端からコケまくった。</p>

<h3>&ldquo;uninitialized constant DashboardController&rdquo;</h3>

<p><code>rails g active_admin:install</code>してとりあえず見るかーと、<br/>
トップページアクセスしたら出るエラー。</p>

<h3>&ldquo;couldn&rsquo;t find file &lsquo;jquery-ui&rsquo;&rdquo;</h3>

<p><code>jQuery UI</code>が見つからないエラー。<br/>
いや、gemでバッチリ指定して入れてるのに・・・<br/>
こっちがだいぶハマった。</p>

<h2>Solution</h2>

<h3>&ldquo;uninitialized constant DashboardController&rdquo;</h3>

<p>これは<code>routes.rb</code>の書き方が問題らしい。</p>

<p><code>activeadmin</code>をインストールすると、<code>routes.rb</code>に以下のコードが追加されるのだけど、</p>

<figure class='code'><figcaption><span>routes.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">devise_for</span> <span class="ss">:admin_users</span><span class="p">,</span> <span class="ss">ActiveAdmin</span><span class="p">:</span><span class="ss">:Devise</span><span class="o">.</span><span class="n">config</span>
</span><span class='line'><span class="no">ActiveAdmin</span><span class="o">.</span><span class="n">routes</span><span class="p">(</span><span class="nb">self</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>これが<code>routes.rb</code>の中で、rootパスより前にあるとダメらしい・・ｗ<br/>
なので、rootパスの記述を上記コードより上に持ってくればOK。</p>

<figure class='code'><figcaption><span>routes.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">root</span> <span class="ss">:to</span> <span class="o">=&gt;</span> <span class="s1">&#39;index#index&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="n">devise_for</span> <span class="ss">:admin_users</span><span class="p">,</span> <span class="ss">ActiveAdmin</span><span class="p">:</span><span class="ss">:Devise</span><span class="o">.</span><span class="n">config</span>
</span><span class='line'><span class="no">ActiveAdmin</span><span class="o">.</span><span class="n">routes</span><span class="p">(</span><span class="nb">self</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<h3>&ldquo;couldn&rsquo;t find file &lsquo;jquery-ui&rsquo;&rdquo;</h3>

<p>問題は、</p>

<ul>
<li><code>activeadmin</code>が<code>jQuery</code>と<code>jQuery UI</code>を使用する</li>
<li><code>jquery-rails, 3.0.0</code>から<code>jQuery UI</code>が切り離された</li>
<li><code>activeadmin</code>の<code>application.js</code>内で<code>jQuery UI</code>の呼び方が間違っている</li>
</ul>


<h4><code>activeadmin</code>が<code>jQuery</code>と<code>jQuery UI</code>を使用する</h4>

<p>独自に<code>application.js</code>から<code>jQuery</code>と<code>jQuery UI</code>を呼んでいる</p>

<h4><code>jquery-rails, 3.0.0</code>から<code>jQuery UI</code>が切り離された</h4>

<p>フォルダに存在しないものをimportしようとして見つかりませんエラーのパターン。<br/>
エラーメッセージでググるとほぼこれに当たる。<br/>
そして解決策が<code>jquery-rails</code>のバージョンを<code>2.3.0</code>に下げろというもの。<br/>
要するに<code>jQuery UI</code>が切り離される前のバージョンにしろってことなんだけど、<br/>
自分の場合はこれではうまくいかなかった。</p>

<h4><code>activeadmin</code>の<code>application.js</code>内で<code>jQuery UI</code>の呼び方が間違っている</h4>

<p>結局自分の場合はこれが問題だった。<br/>
下のソースを見ると、<code>jquery-ui</code>を呼んでいるのだけど、<br/>
これだと名前が解決できないようで、呼び出せない。</p>

<figure class='code'><figcaption><span>/path/to/rails_app/vendor/bundle/ruby/1.9.1/gems/activeadmin-0.6.0/app/assets/javascripts/active_admin/base.js</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="c1">//= require jquery</span>
</span><span class='line'><span class="c1">//= require jquery-ui</span>
</span><span class='line'><span class="c1">//= require jquery_ujs</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//= require active_admin/application</span>
</span></code></pre></td></tr></table></div></figure>


<p>そこで、<code>jquery-ui-rails</code>の<a href="https://github.com/joliss/jquery-ui-rails">Githubドキュメント</a>を読むと、</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>To require all jQuery UI modules,  add the following to your application.js:
</span><span class='line'>
</span><span class='line'>//= require jquery.ui.all
</span></code></pre></td></tr></table></div></figure>


<p>と書いてある。
先程とは呼び方が異なっている。</p>

<p>なので、Gemのassetsの中身を直接書き換え、以下のように変更したところ動くようになった。</p>

<figure class='code'><figcaption><span>/path/to/rails_app/vendor/bundle/ruby/1.9.1/gems/activeadmin-0.6.0/app/assets/javascripts/active_admin/base.js</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="c1">//= require jquery</span>
</span><span class='line'><span class="c1">//= require jquery.ui.all</span>
</span><span class='line'><span class="c1">//= require jquery_ujs</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//= require active_admin/application</span>
</span></code></pre></td></tr></table></div></figure>


<h2>モンキーパッチの当て方がわかりませんorz</h2>

<p>上記の<code>jQuery UI</code>を呼び出す方法を変更する修正だけど、<br/>
直接Gemのファイルいじるのは間違いなくバッドノウハウのはず。<br/>
だからモンキーパッチを当てておきたいのだけど、<br/>
ググって出てくる方法はクラスをオーバーライドするものばかりで、<br/>
assetsの中身を書き換えたい場合はどうすればいいんだろう？<br/>
誰か知っていたら教えて下さい＞＜；</p>

<h2>References</h2>

<ul>
<li><a href="http://stackoverflow.com/questions/15818446/active-admin-ruby-on-rails-dashboard-controller-error">Active Admin Ruby on rails Dashboard Controller Error</a></li>
<li><a href="https://github.com/joliss/jquery-ui-rails">[Gem] jquery-ui-rails</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[GitHubが使っているちょっとしたCSSのテクニック]]></title>
    <link href="http://lunchub.github.io/blog/2013/06/14/github-s-small-css-trick/"/>
    <updated>2013-06-14T16:16:00+09:00</updated>
    <id>http://lunchub.github.io/blog/2013/06/14/github-s-small-css-trick</id>
    <content type="html"><![CDATA[<h2>Scribble</h2>

<h3>Summary</h3>

<p>GitHubを眺めていてちょっとしたCSSのテクニックを発見した。<br/>
ページ上部のアイコンのそばに表示されているPUBLICという文字列がある。<br/>
この文字列が、画面サイズ（横）によって横書き&lt;&ndash;>縦書きと変化する。</p>

<p><a href="http://lunchub.github.io/images/posts/2013/06/2013-06-14-16-59-42.jpg"><img src="http://lunchub.github.io/images/posts/2013/06/2013-06-14-16-59-42.jpg" alt="GitHub css trick1" /></a></p>

<p>が、画面サイズ（横）を小さくすると・・</p>

<p><a href="http://lunchub.github.io/images/posts/2013/06/2013-06-14-17-01-27.jpg"><img src="http://lunchub.github.io/images/posts/2013/06/2013-06-14-17-01-27.jpg" alt="GitHub css trick1" /></a></p>

<p>になるｗ <code>ヒュッ</code>っというエフェクト付きで・・ｗ<br/>
CSS3かJavaScript使ってるんだろうなーと理解したけど、<br/>
こういう細かい所まで凝っていて思わず楽しくなったｗ</p>

<p>で、実際にどうやっているのか調べてみた。</p>

<h3>Conclusion</h3>

<p>ソースを見ると、CSSのみで実装されていることがわかる。<br/>
実装のキモは、</p>

<ul>
<li>Media Queries</li>
<li><code>transform</code>プロパティ</li>
<li><code>transition</code>プロパティ</li>
</ul>


<p>の3点だと思う。
仕組みとしては、</p>

<ul>
<li>画面サイズ（横）が<code>1075px</code>より大きい場合は基本CSSが呼ばれるだけ</li>
<li>画面サイズ（横）が<code>1075px</code>以下になると、<br/>
Media Queriesで指定されているプロパティでオーバーライドされる

<ul>
<li>その際<code>transition</code>で指定した、ベジエ曲線と所要時間に従い、<br/>
変更の発生したプロパティ<code>transform</code>のアニメーションが実行される</li>
</ul>
</li>
</ul>


<p>ということかな。</p>

<p><code>transition</code>の第一引数にはアニメーションを実行するプロパティを指定できる。<br/>
<code>all</code>にすると対応している全てのプロパティにおいて、<br/>
アニメーションの実行が適用される。<br/>
ここで指定されていないプロパティは即座に変更が反映される。<br/>
これってオブザーバの仕組みっぽいな・・？とか妄想。</p>

<p>以下ソース。</p>

<figure class='code'><figcaption><span>html</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&quot;repo-label&quot;</span><span class="nt">&gt;&lt;span&gt;</span>public<span class="nt">&lt;/span&gt;&lt;/span&gt;</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>基本css</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='css'><span class='line'><span class="nc">.pagehead.repohead</span> <span class="nt">span</span><span class="nc">.repo-label</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">position</span><span class="o">:</span> <span class="k">absolute</span><span class="p">;</span>
</span><span class='line'>  <span class="k">top</span><span class="o">:</span> <span class="m">15px</span><span class="p">;</span>
</span><span class='line'>  <span class="k">left</span><span class="o">:</span> <span class="m">-75px</span><span class="p">;</span>
</span><span class='line'>  <span class="k">width</span><span class="o">:</span> <span class="m">65px</span><span class="p">;</span>
</span><span class='line'>  <span class="k">margin-top</span><span class="o">:</span> <span class="m">-14px</span><span class="p">;</span>
</span><span class='line'>  <span class="k">text-align</span><span class="o">:</span> <span class="k">right</span><span class="p">;</span>
</span><span class='line'>  <span class="k">font-size</span><span class="o">:</span> <span class="m">11px</span><span class="p">;</span>
</span><span class='line'>  <span class="k">text-transform</span><span class="o">:</span> <span class="k">uppercase</span><span class="p">;</span>
</span><span class='line'>  <span class="k">color</span><span class="o">:</span> <span class="m">#b9b9b9</span><span class="p">;</span>
</span><span class='line'>  <span class="k">font-weight</span><span class="o">:</span> <span class="m">300</span><span class="p">;</span>
</span><span class='line'>  <span class="k">letter-spacing</span><span class="o">:</span> <span class="m">0px</span><span class="p">;</span>
</span><span class='line'>  <span class="k">text-shadow</span><span class="o">:</span> <span class="k">none</span><span class="p">;</span>
</span><span class='line'>  <span class="n">transition</span><span class="o">:</span> <span class="n">all</span> <span class="m">0.4s</span> <span class="n">ease</span><span class="o">-</span><span class="n">in</span><span class="o">-</span><span class="n">out</span><span class="p">;</span>
</span><span class='line'>  <span class="o">-</span><span class="n">webkit</span><span class="o">-</span><span class="n">transition</span><span class="o">:</span> <span class="n">all</span> <span class="m">0.4s</span> <span class="n">ease</span><span class="o">-</span><span class="n">in</span><span class="o">-</span><span class="n">out</span> <span class="m">0</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>Media Queries指定CSS</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='css'><span class='line'><span class="k">@media</span> <span class="nt">only</span> <span class="nt">screen</span> <span class="nt">and</span> <span class="o">(</span><span class="nt">max-width</span> <span class="nt">1075px</span><span class="o">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="nc">.pagehead.repohead</span> <span class="nt">span</span><span class="nc">.repo-label</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>    <span class="n">transform</span><span class="o">:</span><span class="n">rotate</span><span class="p">(</span><span class="m">-90</span><span class="n">deg</span><span class="p">);</span>
</span><span class='line'>    <span class="o">-</span><span class="n">webkit</span><span class="o">-</span><span class="n">transform</span><span class="o">:</span><span class="n">rotate</span><span class="p">(</span><span class="m">-90</span><span class="n">deg</span><span class="p">);</span>
</span><span class='line'>    <span class="o">-</span><span class="n">moz</span><span class="o">-</span><span class="n">transform</span><span class="o">:</span><span class="n">rotate</span><span class="p">(</span><span class="m">-90</span><span class="n">deg</span><span class="p">);</span>
</span><span class='line'>    <span class="o">-</span><span class="n">o</span><span class="o">-</span><span class="n">transform</span><span class="o">:</span><span class="n">rotate</span><span class="p">(</span><span class="m">-90</span><span class="n">deg</span><span class="p">);</span>
</span><span class='line'>    <span class="o">-</span><span class="n">ms</span><span class="o">-</span><span class="n">transform</span><span class="o">:</span><span class="n">rotate</span><span class="p">(</span><span class="m">-90</span><span class="n">deg</span><span class="p">);</span>
</span><span class='line'>    <span class="n">filter</span><span class="o">:</span><span class="n">progid</span><span class="o">:</span><span class="n">DXImageTransform</span><span class="o">.</span><span class="n">Microsoft</span><span class="o">.</span><span class="n">BasicImage</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="m">3</span><span class="p">);</span>
</span><span class='line'>    <span class="k">top</span><span class="o">:</span><span class="m">30px</span><span class="p">;</span>
</span><span class='line'>    <span class="k">left</span><span class="o">:-</span><span class="m">46px</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>References</h2>

<ul>
<li><a href="https://developer.mozilla.org/ja/docs/Web/Guide/CSS/Using_CSS_transitions">[MDN] CSS transition の使用</a></li>
<li><a href="http://oli.jp/2010/css-animatable-properties/">transitionで指定できるプロパティ一覧</a></li>
<li><a href="http://www.w3.org/TR/css3-transitions/">[W3C] CSS Transitions</a></li>
<li><a href="https://developer.mozilla.org/ja/docs/Web/Guide/CSS/Using_CSS_transforms">[MDN] CSS transforms の利用</a></li>
<li><a href="http://www.css-lecture.com/log/css3/css3-transform.html">CSS3 変形処理を行う transform プロパティ</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[MySQLでUPDATE文のSETの値は行ごとに評価されている]]></title>
    <link href="http://lunchub.github.io/blog/2013/06/13/mysql-evaluate-set-value-each-row-in-update-query/"/>
    <updated>2013-06-13T19:56:00+09:00</updated>
    <id>http://lunchub.github.io/blog/2013/06/13/mysql-evaluate-set-value-each-row-in-update-query</id>
    <content type="html"><![CDATA[<h2>Issues</h2>

<p>あるテーブルのカラムの値を書き換えたい場合は、<br/>
単純に</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='mysql'><span class='line'><span class="k">UPDATE</span> <span class="ss">`table`</span> <span class="kt">SET</span> <span class="ss">`column`</span> <span class="o">=</span> <span class="s1">&#39;value&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>という形でSQLを実行すれば良い。</p>

<p>ここでvalueをランダムな値にしたい場合は、<br/>
サブクエリを使って</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='mysql'><span class='line'><span class="k">UPDATE</span> <span class="ss">`table`</span> <span class="kt">SET</span> <span class="ss">`column`</span> <span class="o">=</span> <span class="p">(</span><span class="k">SELECT</span> <span class="nf">ROUND</span><span class="p">(</span><span class="nf">RAND</span><span class="p">()</span><span class="o">*</span><span class="mi">10</span><span class="p">))</span>
</span></code></pre></td></tr></table></div></figure>


<p>にするのだけど、<br/>
問題はこのサブクエリって行ごとに評価されるのかなという疑問があった。</p>

<p>結論としては行ごとに評価されるのだけど、マニュアルみてもいまいちしっくりしない。
Referencesに載せた内容だとなんとなく行ごとに評価されるんだなというのはわかるのだけど。。</p>

<p>すごく基礎的なところがわかっていない気がする・・</p>

<h2>References</h2>

<ul>
<li><a href="http://dev.mysql.com/doc/refman/5.1/ja/update.html">UPDATE 構文</a></li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>もし式の中で tbl_name からカラムにアクセスするなら、UPDATE はカラムの現在の値を利用します。
</span><span class='line'>例えば、次のステートメントは age カラムを現在の値よりも1大きく設定します。
</span><span class='line'>UPDATE persondata SET age=age+1;
</span><span class='line'>単一テーブル UPDATE 割り当ては通常左から右に評価されます。
</span><span class='line'>複合テーブルの更新に関しては、割り当てが特定の順番で行われるという保証はありません。
</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Octopressのコードブロックでテンプレートタグをエスケープする方法]]></title>
    <link href="http://lunchub.github.io/blog/2013/06/11/how-to-espace-jekyll-template-tag/"/>
    <updated>2013-06-11T18:57:00+09:00</updated>
    <id>http://lunchub.github.io/blog/2013/06/11/how-to-espace-jekyll-template-tag</id>
    <content type="html"><![CDATA[<h2>Issues</h2>

<p>OctopressでJekyllテンプレートのコードブロックを表示する際、<br/>
Jekyllのテンプレートタグが非表示になってしまう。</p>

<h2>Solution</h2>

<h3>エスケープタグを使う</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>{% \raw %}
</span><span class='line'>エスケープしたいソース
</span><span class='line'>{% \endraw %}
</span><span class='line'>
</span><span class='line'>*rawの前のバックスラッシュは不要です。（rawのエスケープができないので仕方なく・・）</span></code></pre></td></tr></table></div></figure>


<p>Jekyllの公式ドキュメントがわかりづらくて探せなかった・・<br/>
やっぱりStackoverflowは便利。</p>

<h2>References</h2>

<p><a href="http://stackoverflow.com/questions/15786144/how-to-escape-in-markdown-on-octopress">How to escape {{ in markdown on Octopress?</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[OctopressにDISQUSのコメントウィジェットを設置する方法]]></title>
    <link href="http://lunchub.github.io/blog/2013/06/11/how-to-add-disqus-s-recent-comments-widget-on-octopress/"/>
    <updated>2013-06-11T18:27:00+09:00</updated>
    <id>http://lunchub.github.io/blog/2013/06/11/how-to-add-disqus-s-recent-comments-widget-on-octopress</id>
    <content type="html"><![CDATA[<h2>Issues</h2>

<p>OctopressのサイドバーにDISQUSの最近のコメント一覧を表示させたい。</p>

<h2>Solution</h2>

<p>以下の手順で設置できたのでメモ。</p>

<h3>サイドバー表示用HTMLの作成</h3>

<figure class='code'><figcaption><span>custom/asides/disqus_recent_comments.html</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>{% if site.disqus_short_name %}
</span><span class='line'><span class="nt">&lt;section&gt;</span>
</span><span class='line'>  <span class="nt">&lt;h1&gt;</span>Recent Comments<span class="nt">&lt;/h1&gt;</span>
</span><span class='line'>  <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;dsq-recentcomments&quot;</span> <span class="na">class=</span><span class="s">&quot;dsq-widget&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;script </span><span class="na">type=</span><span class="s">&quot;text/javascript&quot;</span> <span class="na">src=</span><span class="s">&quot;http://disqus.com/forums/{{ site.disqus_short_name }}/recent_comments_widget.js?hide_avatars=0&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/div&gt;</span>
</span><span class='line'><span class="nt">&lt;/section&gt;</span>
</span><span class='line'>{% endif %}
</span></code></pre></td></tr></table></div></figure>


<h3>_config.ymlの編集</h3>

<figure class='code'><figcaption><span>_config.yml</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="c1"># サイドバー上の表示させたい位置に差し込む</span>
</span><span class='line'><span class="l-Scalar-Plain">default_asides:[....., custom/asides/disqus_recent_comments.html]</span>
</span><span class='line'>
</span><span class='line'><span class="l-Scalar-Plain"># DISQUSのフォーラム名を設定する</span>
</span><span class='line'><span class="l-Scalar-Plain">disqus_short_name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">lunchub</span>
</span></code></pre></td></tr></table></div></figure>


<h3>オプション</h3>

<p>基本的に上記手順で表示できるが、いくつかオプションがある模様。<br/>
JavaScriptの呼び出しクエリに適宜付加してください。</p>

<ul>
<li>hide_avatars :

<ul>
<li>アバターを表示させないか（<code>1</code>だと非表示、<code>0</code>だと表示）</li>
<li>自分のコメントは<code>1</code>にすると見えなくなるっぽい？</li>
</ul>
</li>
<li>num_items :

<ul>
<li>コメントを何件表示させるか</li>
</ul>
</li>
<li>excerpt_length :

<ul>
<li>コメントの最大表示文字数</li>
</ul>
</li>
</ul>


<h2>References</h2>

<p><a href="http://fusion94.org/blog/2013/01/11/recent-comments-as-an-asides/">Recent Comments as an Asides</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[CoffeeScript メモ]]></title>
    <link href="http://lunchub.github.io/blog/2013/06/10/hamari-on-coffeescript/"/>
    <updated>2013-06-10T17:23:00+09:00</updated>
    <id>http://lunchub.github.io/blog/2013/06/10/hamari-on-coffeescript</id>
    <content type="html"><![CDATA[<h2>Environment</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Mac OSX 10.7.5 (Lion)
</span><span class='line'>CoffeeScript version 1.6.3</span></code></pre></td></tr></table></div></figure>


<h2>Tips</h2>

<h3>if文評価後の処理の書き方</h3>

<h4>if の前に書く</h4>

<figure class='code'><figcaption><span>before if</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='coffeescript'><span class='line'><span class="c1"># pattern 1: put defiend function name</span>
</span><span class='line'><span class="nx">a_function</span> <span class="nf">-&gt;</span>
</span><span class='line'>  <span class="nx">alert</span> <span class="s">&#39;test!&#39;</span>
</span><span class='line'>  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="s">&#39;fired!&#39;</span><span class="p">;</span>
</span><span class='line'>  <span class="k">return</span>
</span><span class='line'>
</span><span class='line'><span class="nx">$</span><span class="p">(</span><span class="s">&#39;#target&#39;</span><span class="p">)</span>
</span><span class='line'>  <span class="p">.</span><span class="nx">on</span> <span class="s">&#39;keyup&#39;</span><span class="p">,</span> <span class="nf">(e) -&gt;</span>
</span><span class='line'>    <span class="nx">a_function</span> <span class="k">if</span> <span class="nx">e</span><span class="p">.</span><span class="nx">which</span> <span class="o">is</span> <span class="mi">13</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># pattern 2: wrap with () and separate row by ;</span>
</span><span class='line'><span class="nx">$</span><span class="p">(</span><span class="s">&#39;#target&#39;</span><span class="p">)</span>
</span><span class='line'>  <span class="p">.</span><span class="nx">on</span> <span class="s">&#39;keyup&#39;</span><span class="p">,</span> <span class="nf">(e) -&gt;</span>
</span><span class='line'>    <span class="p">(</span><span class="nx">alert</span> <span class="s">&#39;test!&#39;</span><span class="p">;</span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="s">&#39;fired!&#39;</span><span class="p">;</span><span class="k">return</span><span class="p">)</span> <span class="k">if</span> <span class="nx">e</span><span class="p">.</span><span class="nx">which</span> <span class="o">is</span> <span class="mi">13</span>
</span></code></pre></td></tr></table></div></figure>


<h4>if の次の行からインデントして書く</h4>

<figure class='code'><figcaption><span>after if</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='coffeescript'><span class='line'><span class="nx">$</span><span class="p">(</span><span class="s">&#39;#target&#39;</span><span class="p">)</span>
</span><span class='line'>  <span class="p">.</span><span class="nx">on</span> <span class="s">&#39;keyup&#39;</span><span class="p">,</span> <span class="nf">(e) -&gt;</span>
</span><span class='line'>    <span class="k">if</span> <span class="nx">e</span><span class="p">.</span><span class="nx">which</span> <span class="o">is</span> <span class="mi">13</span>
</span><span class='line'>      <span class="nx">alert</span> <span class="s">&#39;test!&#39;</span>
</span><span class='line'>      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="s">&#39;fired!&#39;</span>
</span><span class='line'>      <span class="k">return</span>
</span></code></pre></td></tr></table></div></figure>


<p>出力後の結果はそれぞれ同じになる。<br/>
前者は<code>if</code>の前を関数として評価しているのだろうか。<br/>
直感的なのは後者のやり方かなあ。<br/>
booleanの返却程度の簡単な処理なら1行にできる前者でも良いか。</p>

<p>変換後のソースチェックはここでできます。 &ndash;> <a href="http://js2coffee.org/">js2coffee</a></p>

<h2>References</h2>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[VimでCoffeeScriptのシンタックスチェックを行う方法]]></title>
    <link href="http://lunchub.github.io/blog/2013/06/10/syntax-check-for-coffee-script-on-vim/"/>
    <updated>2013-06-10T15:50:00+09:00</updated>
    <id>http://lunchub.github.io/blog/2013/06/10/syntax-check-for-coffee-script-on-vim</id>
    <content type="html"><![CDATA[<h2>Environment</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Mac OSX 10.7.5 (Lion)
</span><span class='line'>Vim 7.3.754</span></code></pre></td></tr></table></div></figure>


<h2>Issues</h2>

<p>VimでSyntasticを導入しているものの、CoffeeScriptの保存時に
シンタックスチェックが走らない。</p>

<h2>Solution</h2>

<p>CoffeeScriptとCoffeeLintをインストールしてください(ﾉ´∀｀*)</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>npm install -g coffee-script
</span><span class='line'>npm install -g coffeelint
</span><span class='line'>
</span><span class='line'>* -gはグローバルオプション
</span></code></pre></td></tr></table></div></figure>


<p>バージョンは<code>1.6.2</code>以上が必要です。</p>

<p>そしてパスを通す。NODE_PATHも一応通しておいたほうがいいらしい。</p>

<figure class='code'><figcaption><span>.zshrc</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span>/usr/local/share/npm/bin:<span class="nv">$PATH</span>
</span><span class='line'><span class="nb">export </span><span class="nv">NODE_PATH</span><span class="o">=</span>/usr/local/share/npm/lib/node_modules:<span class="nv">$NODE_PATH</span>
</span></code></pre></td></tr></table></div></figure>


<p>Syntasticのソースを見るとexecutableで<code>coffee</code>と<code>coffeelint</code>コマンドを探しにいっています。<br/>
コマンドが見つからないエラーはないのかな・・</p>

<h2>References</h2>

<p><a href="https://github.com/scrooloose/syntastic/tree/master/syntax_checkers/coffee">[Github]scrooloose/syntastic</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Octopressで関連エントリを表示する方法]]></title>
    <link href="http://lunchub.github.io/blog/2013/06/07/how-to-show-related-posts-in-octopress/"/>
    <updated>2013-06-07T12:15:00+09:00</updated>
    <id>http://lunchub.github.io/blog/2013/06/07/how-to-show-related-posts-in-octopress</id>
    <content type="html"><![CDATA[<h2>Issues</h2>

<p>参考サイトの手順通りにプラグインを導入しても、<br/>
関連エントリが表示されない。</p>

<h2>Solution</h2>

<p>プラグインの仕様が変わっていました・・ｗ<br/>
<a href="https://github.com/LawrenceWoodman/related_posts-jekyll_plugin/commit/bcef5ff59e038d3276c66f710ba2ccc99a9a495e">[GitHub] Switch from categories to tags</a><br/>
カテゴリではなく、タグを使って関連エントリを探してくるように変更されたようです。<br/>
なので、tagsにキーワードを登録していけば問題なく関連エントリが表示されます。</p>

<p>カテゴリだと大雑把すぎるということなのかな・・？</p>

<h2>References</h2>

<ul>
<li><a href="http://blog.glidenote.com/blog/2012/01/04/octopress-related-posts/">OctopressでRelated Posts(関連エントリー)を表示させるようにした</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Railsでassetsのログを出力させない]]></title>
    <link href="http://lunchub.github.io/blog/2013/06/05/do-not-log-requesting-assets-on-rails/"/>
    <updated>2013-06-05T17:11:00+09:00</updated>
    <id>http://lunchub.github.io/blog/2013/06/05/do-not-log-requesting-assets-on-rails</id>
    <content type="html"><![CDATA[<h2>Environment</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Mac OSX 10.7.5 (Lion)
</span><span class='line'>ruby 1.9.3p392 (2013-02-22 revision 39386) [x86_64-darwin11.4.2]
</span><span class='line'>Rails 3.2.13</span></code></pre></td></tr></table></div></figure>


<h2>Issues</h2>

<p>development環境で作業を行う際、下の画像のように<code>tail -f log/development.log</code>で<br/>
ログを垂れ流しているのだけど、画面生成の際走るSQLなんかを確認したい時に<br/>
assetsのログが邪魔すぎる・・・</p>

<p><a href="http://lunchub.github.io/images/posts/2013/06/7662bc00999c167cac1b705a82c3466b.jpg"><img src="http://lunchub.github.io/images/posts/2013/06/7662bc00999c167cac1b705a82c3466b.jpg" alt="rails assets log" /></a></p>

<h2>Solution</h2>

<p>ログを見ると、</p>

<ul>
<li>assetに対するGETログ</li>
<li>assetの処理ログ</li>
</ul>


<p>の2種類が表示されていることがわかる。<br/>
これらをまとめて非表示にする方法はないようで、個別に対応する必要がある。</p>

<ul>
<li>assetに対するGETログ</li>
</ul>


<p><code>app\config\initializers\quiet_assets.rb</code>を作成し、以下のコードをコピペする。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="ss">Rails</span><span class="p">:</span><span class="ss">:Rack</span><span class="o">::</span><span class="no">Logger</span><span class="o">.</span><span class="n">class_eval</span> <span class="k">do</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">call_with_quiet_assets</span><span class="p">(</span><span class="n">env</span><span class="p">)</span>
</span><span class='line'>    <span class="n">previous_level</span> <span class="o">=</span> <span class="no">Rails</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">level</span>
</span><span class='line'>    <span class="no">Rails</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">level</span> <span class="o">=</span> <span class="ss">Logger</span><span class="p">:</span><span class="ss">:ERROR</span> <span class="k">if</span> <span class="n">env</span><span class="o">[</span><span class="s1">&#39;PATH_INFO&#39;</span><span class="o">].</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;/assets/&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>
</span><span class='line'>    <span class="n">call_without_quiet_assets</span><span class="p">(</span><span class="n">env</span><span class="p">)</span><span class="o">.</span><span class="n">tap</span> <span class="k">do</span>
</span><span class='line'>      <span class="no">Rails</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">level</span> <span class="o">=</span> <span class="n">previous_level</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>  <span class="n">alias_method_chain</span> <span class="ss">:call</span><span class="p">,</span> <span class="ss">:quiet_assets</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>assetの処理ログ</li>
</ul>


<p><code>enviroments/development.rb</code> に以下のコードを追記する。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">config</span><span class="o">.</span><span class="n">assets</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="kp">false</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Another solution</h2>

<ul>
<li><code>quiet_assets</code> gemを使用する
このgemでやっている内容は上記対策と同様です．</li>
</ul>


<h2>References</h2>

<ul>
<li><a href="https://github.com/rails/rails/issues/4569">config.assets.logger not working</a></li>
</ul>

]]></content>
  </entry>
  
</feed>
